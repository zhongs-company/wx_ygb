import config from './config'

export var isType = function(type) {
    return function(obj) {
        return {}.toString.call(obj) == "[object " + type + "]"
    }
}
export var isObject = isType("Object")
export var isString = isType("String")
export var isArray = Array.isArray || isType("Array")
export var isFunction = isType("Function")
export var isUndefined = isType("Undefined")

/**
 * 格式化时间
 */
export var time = function(date) {
    var date = new Date(date);
    var h = date.getHours();
    var m = date.getMinutes()
    if (h < 10) {
        h = '0' + h;
    }
    if (m < 10) {
        m = '0' + m;
    }
    return h + ' : ' + m;
}

/**
 * 逗号分隔的字符串
 * '1,2,3'
 * 返回 [1,2,3]
 */
export var split = function(date) {
    return date.split(',').filter(function(item) {
        return item;
    }).map(function(item) {
        if (item.indexOf('/') === 0) {
            return item.substring(1, item.length);
        } else {
            return item;
        }
    });
}

/**
 *用来解析url参数
 *返回 key value 键值对对象
 */
export var parseQueryString = function(url) {
    var obj = {};
    var start = url.indexOf("?") + 1;
    var str = url.substr(start);
    var arr = str.split("&");
    for (var i = 0; i < arr.length; i++) {
        var arr2 = arr[i].split("=");
        obj[arr2[0]] = arr2[1];
    }
    return obj;
}

export var toFixed = function(number) {
    return (number / 100).toFixed(2);
}

export var getUrl = function(url) {
    return `${config.websocket_data_src}/${url}`;
}

export var getHeadSrc = function(str) {
    return str && str.indexOf('/0') && str.substr(0, str.length - 1) + '96';
}

export var rdNum = function() {
    return Math.random().toString(36).substr(3);
}

export var setPageTile = function(str) {
    if (!str) return;
    wx.setNavigationBarTitle({
        title: str
    })
}

export var countDown = (t) => {


    var h = Math.floor(t / 3600);
    var f = Math.floor(t / 60);
    var m = Math.floor(t % 60);

    var d = [];

    if (h >= 10) {
        d.push((h + '').substr(0, 1));
        d.push((h + '').substr(1, 1));
    } else {
        d.push(0 + '');
        d.push((h + '').substr(0, 1));
    }

    if (f >= 10) {
        d.push((f + '').substr(0, 1));
        d.push((f + '').substr(1, 1));
    } else {
        d.push(0 + '');
        d.push((f + '').substr(0, 1));
    }

    if (m >= 10) {
        d.push((m + '').substr(0, 1));
        d.push((m + '').substr(1, 1));
    } else {
        d.push(0 + '');
        d.push((m + '').substr(0, 1));
    }

    return d;

}

//将对象元素转换成字符串以作比较
function obj2key(obj, keys) {
    var n = keys.length,
        key = [];
    while (n--) {
        key.push(obj[keys[n]]);
    }
    return key.join('|');
}
//去重操作
export let uniqeByKeys = (array, keys) => {
    var arr = [];
    var hash = {};
    for (var i = 0, j = array.length; i < j; i++) {
        var k = obj2key(array[i], keys);
        if (!(k in hash)) {
            hash[k] = true;
            arr.push(array[i]);
        }
    }
    return arr;
}


/**
 * 微信选择地址
 */
export let wxAddress = (cb) => {

    let chooseAddress = () => {
        wx.chooseAddress({
            success: (res) => {
               cb && cb(res)
            }
        })
    }

    wx.getSetting({
        success(res) {
            if (!res.authSetting['scope.address']) {
                wx.authorize({
                    scope: 'scope.address',
                    success() {
                        chooseAddress();
                    },
                    fail: () => {
                        wx.openSetting({
                            success: (res) => {
                                if (res.authSetting["scope.address"]) {
                                    chooseAddress();
                                }
                            }
                        })
                    }
                })
            } else {
                chooseAddress();
            }
        }
    })
}